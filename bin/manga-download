#! /usr/bin/env node --harmony

const program = require('commander');
const support = require('./support.json');
const Manga = support.WEBSITES.reduce((requires,name,index) => {
    requires[name] = require(`../dist/crawler/${name}/manga`)['default'];
    return requires;
},{});


program
    .option('-d, --dist [dist]','manga download directory')
    .option('-c --chapter [chapter]','download specific chapter')
    .action((name,cmd)=>{
        let [website,id] = name.split('/');
        if (!id) {
            throw new Error('Params must be format like website/id');
        } else if (support.WEBSITES.indexOf(website) < 0) {
            throw new Error(`Params website not support. Must chosen from ${SUPPORT_WEBSITE} .`);
        }
        let manga = new Manga[website](id,cmd.dist);
        manga.download(cmd.chapter);
    })
    .parse(process.argv);
